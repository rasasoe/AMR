# AMR

# 3륜 옴니휠 서빙 로봇 제어 프로젝트



## 📖 1. 프로젝트 개요

이 프로젝트는 **Raspberry Pi Pico**를 메인 MCU로 사용하여 3륜 옴니휠 기반 로봇의 정밀 이동을 구현하는 것을 목표로 합니다. MicroPython을 사용하여 하드웨어를 직접 제어하며, 엔코더 피드백과 PID 제어(P-Control)를 통해 안정적인 구동 시스템을 개발합니다.

---

## ⚙️ 2. 하드웨어 구성

### 주요 부품 목록

| 부품 종류 | 모델명 / 사양 |
| :--- | :--- |
| **MCU** | Raspberry Pi Pico |
| **모터** | GM37B-3322E (DC 12V, 1:30, 11PPR) |
| **모터 드라이버** | L298N Dual H-Bridge |
| **옴니휠** | 60mm Omni Wheel |
| **전원** | 12V Battery (e.g., Li-Po) |

### 로봇 기구학 정보 (Kinematics)

* **구동 방식**: 3륜 옴니휠 (휠 각도: 90°, 210°, 330°)
* **로봇 중심-바퀴 거리**: **100 mm** (0.1 m)
* **휠 지름**: **60 mm** (0.06 m)

---

## 🔌 3. 핀 맵 (Pin Mapping)

| 기능 | 모터 1 (후방) | 모터 2 (우전방) | 모터 3 (좌전방) |
| :--- | :---: | :---: | :---: |
| **PWM (ENA)** | `GP2` | `GP8` | `GP12` |
| **IN1** | `GP0` | `GP6` | `GP10` |
| **IN2** | `GP1` | `GP7` | `GP11` |
| **엔코더 A** | `GP3` | `GP9` | `GP13` |

---

## 💡 4. 핵심 제어 로직

### P 제어 (Proportional Control)

교수님의 요구사항에 따라 PID 제어 중 **P(비례) 제어**만을 사용하여 각 휠의 RPM을 제어합니다. `OmniRobot.update()` 메서드 내에서 목표 RPM과 현재 RPM의 오차(Error)에 비례常数(`kp`)를 곱하여 모터 출력을 조절합니다.

### 엔코더 피드백 기반 이동 (Closed-loop Control)

기존의 시간 기반 이동 방식은 오차가 크기 때문에, 엔코더의 펄스 카운트를 직접 추적하여 목표 거리와 각도를 정밀하게 제어하는 **폐쇄 루프 방식**을 구현했습니다.

* `go_distance(distance_m)`: 목표 거리를 엔코더 틱으로 변환한 후, 실제 누적된 틱 수가 목표에 도달하면 정지합니다.
* `turn_angle(angle_deg)`: 목표 각도를 바퀴가 움직여야 할 거리(호의 길이)로 계산하고, 이를 다시 엔코더 틱으로 변환하여 실제 회전량을 추적합니다.

---

## 🚀 5. 향후 개선 과제

1.  **Quadrature Encoder 구현**: 현재 하드웨어는 엔코더 1채널만 연결되어 방향 감지가 불가능합니다. 엔코더 B 채널을 추가로 연결하고 **쿼드러처 인코딩** 로직을 구현하면, 역회전까지 감지하여 더욱 정밀한 위치 추정이 가능해집니다.
2.  **PID 제어기 완성**: 현재 P 제어만으로도 준수한 성능을 보이지만, **I(적분) 제어**를 추가하여 정상상태 오차를 제거하고, **D(미분) 제어**를 추가하여 오버슈트를 줄이면 로봇의 반응성과 안정성을 크게 향상시킬 수 있습니다.